<!DOCTYPE html>
<html lang="en-us">

  <head>
    <meta charset="utf-8">
    <meta name="theme-color" content="#123652"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Susan Potter">
    <meta name="description" content="/">
    <meta name="keywords" content="Distributed Systems, Functional Programming, Systems Architecture, Software Development, Software Engineering Leadership, Technical Strategy">

    <meta property="og:site_name" content="Susan Potter">
    <meta property="og:title" content="
  Tracking diffs by scoping to file, range, function, method, or class changes in Git - Susan Potter
">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/software/tracking-diffs-by-scoping-to-file-range-function-method-or-class-changes-in-git/">
    <meta property="og:image" content="/">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="/software/tracking-diffs-by-scoping-to-file-range-function-method-or-class-changes-in-git/">
    <meta name="twitter:image" content="/">

    <title>
  Tracking diffs by scoping to file, range, function, method, or class changes in Git - Susan Potter
</title>

    <link rel="canonical" href="/software/tracking-diffs-by-scoping-to-file-range-function-method-or-class-changes-in-git/">
    
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
    
    <link  rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700">
    <link rel="stylesheet" href="/css/normalize.min.css">
    <link rel="stylesheet" href="/css/style.min.css">

    

    
      <link rel="stylesheet" href="/styles/main.css">
    

    <link href="/favicon.ico" rel="shortcut icon">

    
      <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Susan Potter">
      <link href="/index.xml" rel="feed" type="application/rss+xml" title="Susan Potter" />
    

    <meta name="generator" content="Hugo 0.74.3" />
  </head>

  <body class="">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">Susan Potter</a>
    <input type="checkbox" id="menu-control"/>
    <label class="menu-mobile  float-right " for="menu-control">
      <span class="btn-mobile  float-right ">&#9776;</span>
      <ul class="navigation-list">
        
          
            <li class="navigation-item   align-left  ">
              <a class="navigation-link" href="/about/">About</a>
            </li>
          
            <li class="navigation-item   align-left  ">
              <a class="navigation-link" href="/talks/">Talks</a>
            </li>
          
            <li class="navigation-item   align-left  ">
              <a class="navigation-link" href="/software/">Software</a>
            </li>
          
            <li class="navigation-item   align-left  ">
              <a class="navigation-link" href="/snippets/">Snippets</a>
            </li>
          
        
        
      </ul>
    </label>
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>Tracking diffs by scoping to file, range, function, method, or class changes in Git</h1>
      <div class="dateinfo">
        
        <span class="date"><strong>Date:</strong> December 22, 2020</span>
        
        
        <span class="lastmod"><strong>Last modified:</strong> December 22, 2020</span>
        
      
        <div class="draft">DRAFT</div>
      

      </div>

    </header>

    
<p>
One common question I see from developers using Git is how they can
review the history of one function, method, or class over time through
Git&#39;s history of the project.</p>
<p>
In codebases that have evolved over years, a developer just wants to
know how one particular semantic scope of code has changed over time
rather than on a file or directory basis.</p>
<p>
We will start out by revisiting how to scope change diffs per file.</p>
<p>
We will use the Ruby language repository to demonstrate the commands
in this blog post, so please clone the repository like so:</p>
<div class="src src-sh">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ git clone https://github.com/ruby/ruby.git
Cloning into <span style="color:#e6db74">&#39;ruby&#39;</span>...
remote: Enumerating objects: 91, <span style="color:#66d9ef">done</span>.
remote: Counting objects: 100% <span style="color:#f92672">(</span>91/91<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
remote: Compressing objects: 100% <span style="color:#f92672">(</span>77/77<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
remote: Total <span style="color:#ae81ff">488812</span> <span style="color:#f92672">(</span>delta 25<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">63</span> <span style="color:#f92672">(</span>delta 7<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">488721</span>
Receiving objects: 100% <span style="color:#f92672">(</span>488812/488812<span style="color:#f92672">)</span>, 229.77 MiB | 2.78 MiB/s, <span style="color:#66d9ef">done</span>.
Resolving deltas: 100% <span style="color:#f92672">(</span>375083/375083<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.</code></pre></div>
</div>
<div id="outline-container-headline-1" class="outline-3">
<h3 id="headline-1">
Scoping log diffs per file
</h3>
<div id="outline-text-headline-1" class="outline-text-3">
<p>
Sometimes a developer only wants to look at changes in one specific
files in the repository. To do this we would use the <code class="verbatim">git-log</code>
command:</p>
<div class="src src-bash">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git log -- README.md</code></pre></div>
</div>
<p>
or</p>
<div class="src src-bash">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git log -- Makefile</code></pre></div>
</div>
<p>
This will show only the log message and metadata about commits that
contain changes in that file.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-3">
<h3 id="headline-2">
Scoping diffs in a line range of a file
</h3>
<div id="outline-text-headline-2" class="outline-text-3">
<p>
In many projects each source file has a predefined documentation
header and we only want to find the change that introduced an
inconsistency in the documentation header of a particular file.</p>
<p>
To find this we might do the following in our ruby repository:</p>
<div class="src src-bash">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git log -L 1,9:vm.c</code></pre></div>
</div>
<p>
This will show all commits containing changes in lines 1 through 9
inclusive in the file <code class="verbatim">vm.c</code> along with patch diff output for that
part of the file.</p>
</div>
</div>
<div id="outline-container-headline-3" class="outline-3">
<h3 id="headline-3">
Scoping diffs by named block in a file
</h3>
<div id="outline-text-headline-3" class="outline-text-3">
<p>
In large files or when blocks (such as functions, methods, or
classes) of code have been moved around the file, we might want to
limit change log noise especially when that file is updated
regularly. A typical example in a Ruby on Rails application might be
an action method in a controller.</p>
<p>
Let&#39;s consult the man page for <code class="verbatim">git-log</code> like so:</p>
<div class="src src-sh">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ man git-log</code></pre></div>
</div>
<p>
We eventually come across a part like the following:</p>
<div class="src src-text">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">      -L &lt;start&gt;,&lt;end&gt;:&lt;file&gt;, -L :&lt;funcname&gt;:&lt;file&gt;
          Trace the evolution of the line range given by &#34;&lt;start&gt;,&lt;end&gt;&#34; (or the function name regex &lt;funcname&gt;) within the &lt;file&gt;. You may
          not give any pathspec limiters. This is currently limited to a walk starting from a single revision, i.e., you may only give zero or
          one positive revision arguments, and &lt;start&gt; and &lt;end&gt; (or &lt;funcname&gt;) must exist in the starting revision. You can specify this
          option more than once. Implies --patch. Patch output can be suppressed using --no-patch, but other diff formats (namely --raw,
          --numstat, --shortstat, --dirstat, --summary, --name-only, --name-status, --check) are not currently implemented.

          &lt;start&gt; and &lt;end&gt; can take one of these forms:

          •   number

              If &lt;start&gt; or &lt;end&gt; is a number, it specifies an absolute line number (lines count from 1).

          •   /regex/

              This form will use the first line matching the given POSIX regex. If &lt;start&gt; is a regex, it will search from the end of the
              previous -L range, if any, otherwise from the start of file. If &lt;start&gt; is “^/regex/”, it will search from the start of file. If
              &lt;end&gt; is a regex, it will search starting at the line given by &lt;start&gt;.

          •   +offset or -offset

              This is only valid for &lt;end&gt; and will specify a number of lines before or after the line given by &lt;start&gt;.

          If “:&lt;funcname&gt;” is given in place of &lt;start&gt; and &lt;end&gt;, it is a regular expression that denotes the range from the first funcname
          line that matches &lt;funcname&gt;, up to the next funcname line.  “:&lt;funcname&gt;” searches from the end of the previous -L range, if any,
          otherwise from the start of file.  “^:&lt;funcname&gt;” searches from the start of file.</code></pre></div>
</div>
<p>
Ok, we have already seen how to list the relevant log entries with
patches for a line range in a file (in the section above) and now want
to take advantage of the form <code class="verbatim">-L :&lt;funcname&gt;:&lt;file&gt;</code>.</p>
<p>
To look at all changes in the <code class="verbatim">main</code> function of the
<code class="verbatim">ext/nkf/nkf-utf8/nkf.c</code> file in the ruby repository we would issue
the following command:</p>
<div class="src src-bash">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git log -L :main:ext/nkf/nkf-utf8/nkf.c</code></pre></div>
</div>
<p>
Cool, then armed with this new power we should be able to look at
commits and relevant patches within a Ruby function too, right? Let&#39;s
give that a try:</p>
<div class="src src-bash">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git log -L :request_uri:lib/uri/http.rb</code></pre></div>
</div>
<p>
This works but you will notice some of the patches show changed lines
outside of the method block.</p>
<div id="outline-container-headline-4" class="outline-4">
<h4 id="headline-4">
How does this work?
</h4>
<div id="outline-text-headline-4" class="outline-text-4">
<p>
One this to notice is that in the root of the <code class="verbatim">ruby</code> repository is a
file named <code class="verbatim">.gitattributes</code>. This can do many things but for the
purposes of block-based git logs and patch review, the important line
that made the above command mostly work is the following:</p>
<div class="src src-text">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">*.rb diff=ruby</code></pre></div>
</div>
<p>
This is telling Git to assume the file type for all files ending in
and <code class="verbatim">rb</code> extension are <code class="verbatim">ruby</code> files. For diffing purposes this uses a
regex to determine the block boundaries for <code class="verbatim">ruby</code> files:</p>
<p>
https://git.kernel.org/pub/scm/git/git.git/tree/userdiff.c#n183</p>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-5" class="outline-3">
<h3 id="headline-5">
<span class="todo">TODO</span>
Defining new named blocks for new formats and file types
</h3>
</div>
<div id="outline-container-headline-6" class="outline-3">
<h3 id="headline-6">
<span class="todo">TODO</span>
Limitations &amp; prerequisites
</h3>
</div>

  </article>

  
</section>


      </div>
      
        <footer class="footer">
  <section class="container">
    
      <div class="sns-shares sp-sns-shares">
        
          <a class="sns-share twitter-share" aria-label="Share on twitter" href="https://twitter.com/intent/tweet?original_referer=%2fsoftware%2ftracking-diffs-by-scoping-to-file-range-function-method-or-class-changes-in-git%2f&ref_src=twsrc%5Etfw&text=Tracking%20diffs%20by%20scoping%20to%20file%2c%20range%2c%20function%2c%20method%2c%20or%20class%20changes%20in%20Git Susan%20Potter&tw_p=tweetbutton&url=%2fsoftware%2ftracking-diffs-by-scoping-to-file-range-function-method-or-class-changes-in-git%2f"><i class="fab fa-twitter"></i></a>
        
        
          <a class="sns-share linkedIn-share" aria-label="Share on LinkedIn" href="https://www.linkedin.com/sharing/share-offsite/?url=%2fsoftware%2ftracking-diffs-by-scoping-to-file-range-function-method-or-class-changes-in-git%2f"><i class="fab fa-linkedin"></i></a>
        
      </div>
    
    
  </section>
  <div class="fixed-bar">
    <section class="container">
      
      <div class="social-list">
        <span>Profiles:</span>
        
          <span class="social-item">
            <a href="https://github.com/mbbx6spp/" aria-label="Github" >
              
                <i class="fab fa-github" aria-hidden="true"></i>
              
            </a>
          </span>
        
          <span class="social-item">
            <a href="https://keybase.io/mbbx6spp" aria-label="Keybase" >
              
                <i class="fab fa-keybase" aria-hidden="true"></i>
              
            </a>
          </span>
        
          <span class="social-item">
            <a href="https://www.linkedin.com/in/susanpotter/" aria-label="LinkedIn" >
              
                <i class="fab fa-linkedin" aria-hidden="true"></i>
              
            </a>
          </span>
        
          <span class="social-item">
            <a href="https://slideshare.net/mbbx6spp" aria-label="Slideshare" >
              
                <i class="fab fa-slideshare" aria-hidden="true"></i>
              
            </a>
          </span>
        
          <span class="social-item">
            <a href="https://twitter.com/SusanPotter" aria-label="Twitter" >
              
                <i class="fab fa-twitter" aria-hidden="true"></i>
              
            </a>
          </span>
        
      </div>
      
      
        <div class="sns-shares pc-sns-shares">
          <span>Share:</span>
          
            <a class="sns-share twitter-share" aria-label="Share on twitter" href="https://twitter.com/intent/tweet?original_referer=%2fsoftware%2ftracking-diffs-by-scoping-to-file-range-function-method-or-class-changes-in-git%2f&ref_src=twsrc%5Etfw&text=Tracking%20diffs%20by%20scoping%20to%20file%2c%20range%2c%20function%2c%20method%2c%20or%20class%20changes%20in%20Git Susan%20Potter&tw_p=tweetbutton&url=%2fsoftware%2ftracking-diffs-by-scoping-to-file-range-function-method-or-class-changes-in-git%2f"><i class="fab fa-twitter" aria-hidden="true"></i></a>
          
          
            <a class="sns-share linkedIn-share" aria-label="Share on LinkedIn" href="https://www.linkedin.com/sharing/share-offsite/?url=%2fsoftware%2ftracking-diffs-by-scoping-to-file-range-function-method-or-class-changes-in-git%2f"><i class="fab fa-linkedin" aria-hidden="true"></i></a>
          
        </div>
      
    </section>
  </div>
</footer>

      
    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-837842-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


  <script src="/js/app.js"></script>
  
  </body>
</html>
