<!DOCTYPE html>
<html lang="en-us">

  <head>
    <meta charset="utf-8">
    <meta name="theme-color" content="#123652"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Susan Potter">
    <meta name="description" content="/">
    <meta name="keywords" content="Distributed Systems, Functional Programming, Systems Architecture, Software Development, Software Engineering Leadership, Technical Strategy">

    <meta property="og:site_name" content="Susan Potter">
    <meta property="og:title" content="
  JavaScript Performance: Node CLI flags - Susan Potter
">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/snippets/javascript-performance-node-cli-flags/">
    <meta property="og:image" content="/">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="/snippets/javascript-performance-node-cli-flags/">
    <meta name="twitter:image" content="/">

    <title>
  JavaScript Performance: Node CLI flags - Susan Potter
</title>

    <link rel="canonical" href="/snippets/javascript-performance-node-cli-flags/">
    
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
    
    <link  rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700">
    <link rel="stylesheet" href="/css/normalize.min.css">
    <link rel="stylesheet" href="/css/style.min.css">

    

    
      <link rel="stylesheet" href="/styles/main.css">
    

    <link href="/favicon.ico" rel="shortcut icon">

    
      <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Susan Potter">
      <link href="/index.xml" rel="feed" type="application/rss+xml" title="Susan Potter" />
    

    <meta name="generator" content="Hugo 0.64.0" />
  </head>

  <body class="">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">Susan Potter</a>
    <input type="checkbox" id="menu-control"/>
    <label class="menu-mobile  float-right " for="menu-control">
      <span class="btn-mobile  float-right ">&#9776;</span>
      <ul class="navigation-list">
        
          
            <li class="navigation-item   align-left  ">
              <a class="navigation-link" href="/about/">About</a>
            </li>
          
            <li class="navigation-item   align-left  ">
              <a class="navigation-link" href="/talks/">Talks</a>
            </li>
          
            <li class="navigation-item   align-left  ">
              <a class="navigation-link" href="/software/">Software</a>
            </li>
          
            <li class="navigation-item   align-left  ">
              <a class="navigation-link" href="/snippets/">Snippets</a>
            </li>
          
        
        
      </ul>
    </label>
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>JavaScript Performance: Node CLI flags</h1>
      <div class="dateinfo">
        
        <span class="date"><strong>Date:</strong> August 6, 2020</span>
        
        
        <span class="lastmod"><strong>Last modified:</strong> August 6, 2020</span>
        
      

      </div>

    </header>

    
<p>
These are some notes on performance engineering related to generating
insights into Node.js (v8) performance.
</p>
<p>
All material here is specific to the v8 engine found in Node.js,
Chrome, and Opera.
</p>
<p>
Generally useful things to learn to tune JavaScript (for the v8
engine) is natives syntax. You can run JS with natives syntax
directives sprinkled throughout using the Node.js command-line:
</p>
<ul>
<li>
<p>
<code class="verbatim">--allow-natives-syntax</code>
</p>
</li>
</ul>
<p>
Read more on <a href="https://github.com/v8/v8/blob/master/src/runtime/runtime.h">available natives syntax directives available from the source</a>.
</p>
<p>
Another generally useful tool for JavaScript performance engineering
is the <a href="https://developer.mozilla.org/en-US/docs/Web/API/User_Timing_API">User Timing API</a>.
</p>
<h3 id="headline-1">
Speculative optimization with optimization and deoptimization
</h3>
<p>
With speculative optimization we have the bytecode interpreter look at
how a function is used (e.g. what types of values are passed as
arguments) to see if it can delegate to the optimizing compiler for
specialization or related optimization strategies after observing call
usages for patterns.
</p>
<p>
If the observations that the interpreter uses to delegate to the
optimizing compiler gets nullified after delegating to the optimizer
then that unit of code (e.g. function) gets <em>deoptimized</em> and a
request to the interpreter to generate general bytecode with no
optimizations is made incurring more work and slowing the process
down.
</p>
<p>
To understand what gets optimized by the turbofan optimizer and what
gets delegated back for deoptimization from the turbofan to bytecode
generator we can use:
</p>
<ul>
<li>
<p>
<code class="verbatim">--trace-opt</code>
</p>
</li>
<li>
<p>
<code class="verbatim">--trace-deopt</code>
</p>
</li>
</ul>
<p>
The following terms may be used in different contexts to mean similar
things but the following are defined in the bounded context of
speculative optimization.
</p>
<h4 id="headline-2">
Monomorphic
</h4>
<p>
This is where a function handles a specific type only and all call
sites only pass values of that type.
</p>
<p>
Using TypeScript we can ensure consistency of our call sites with
appropriate type annotations:
</p>
<div class="src src-javascript">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">add</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">x</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">number</span>, <span style="color:#a6e22e">y</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">number</span>)<span style="color:#f92672">:</span> <span style="color:#a6e22e">number</span> =&gt; <span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">y</span>;
</code></pre></div>
</div>
<h4 id="headline-3">
Polymorphic
</h4>
<p>
This is where a function handles a range of types effectively making
an optimized switch statement for the cases. The more cases the more
the optimizer loses its effectiveness and gives up where it gets
&#34;demoted&#34; to megamorphic.
</p>
<h4 id="headline-4">
Megamorphic
</h4>
<p>
Anything goes! This breaks the optimizer, big time. Avoid this at all
costs.
</p>
<h3 id="headline-5">
Inlining
</h3>
<h4 id="headline-6">
Functions
</h4>
<p>
Node.js command-line options related to function inlining are:
</p>
<ul>
<li>
<p>
<code class="verbatim">--trace-turbo-inlining</code>
</p>
</li>
</ul>

  </article>

  
</section>


      </div>
      
        <footer class="footer">
  <section class="container">
    
      <div class="sns-shares sp-sns-shares">
        
          <a class="sns-share twitter-share" aria-label="Share on twitter" href="https://twitter.com/intent/tweet?original_referer=%2fsnippets%2fjavascript-performance-node-cli-flags%2f&ref_src=twsrc%5Etfw&text=JavaScript%20Performance%3a%20Node%20CLI%20flags Susan%20Potter&tw_p=tweetbutton&url=%2fsnippets%2fjavascript-performance-node-cli-flags%2f"><i class="fab fa-twitter"></i></a>
        
        
          <a class="sns-share linkedIn-share" aria-label="Share on LinkedIn" href="https://www.linkedin.com/sharing/share-offsite/?url=%2fsnippets%2fjavascript-performance-node-cli-flags%2f"><i class="fab fa-linkedin"></i></a>
        
      </div>
    
    
  </section>
  <div class="fixed-bar">
    <section class="container">
      
      <div class="social-list">
        <span>Profiles:</span>
        
          <span class="social-item">
            <a href="https://github.com/mbbx6spp/" aria-label="Github" >
              
                <i class="fab fa-github" aria-hidden="true"></i>
              
            </a>
          </span>
        
          <span class="social-item">
            <a href="https://keybase.io/mbbx6spp" aria-label="Keybase" >
              
                <i class="fab fa-keybase" aria-hidden="true"></i>
              
            </a>
          </span>
        
          <span class="social-item">
            <a href="https://www.linkedin.com/in/susanpotter/" aria-label="LinkedIn" >
              
                <i class="fab fa-linkedin" aria-hidden="true"></i>
              
            </a>
          </span>
        
          <span class="social-item">
            <a href="https://slideshare.net/mbbx6spp" aria-label="Slideshare" >
              
                <i class="fab fa-slideshare" aria-hidden="true"></i>
              
            </a>
          </span>
        
          <span class="social-item">
            <a href="https://twitter.com/SusanPotter" aria-label="Twitter" >
              
                <i class="fab fa-twitter" aria-hidden="true"></i>
              
            </a>
          </span>
        
      </div>
      
      
        <div class="sns-shares pc-sns-shares">
          <span>Share:</span>
          
            <a class="sns-share twitter-share" aria-label="Share on twitter" href="https://twitter.com/intent/tweet?original_referer=%2fsnippets%2fjavascript-performance-node-cli-flags%2f&ref_src=twsrc%5Etfw&text=JavaScript%20Performance%3a%20Node%20CLI%20flags Susan%20Potter&tw_p=tweetbutton&url=%2fsnippets%2fjavascript-performance-node-cli-flags%2f"><i class="fab fa-twitter" aria-hidden="true"></i></a>
          
          
            <a class="sns-share linkedIn-share" aria-label="Share on LinkedIn" href="https://www.linkedin.com/sharing/share-offsite/?url=%2fsnippets%2fjavascript-performance-node-cli-flags%2f"><i class="fab fa-linkedin" aria-hidden="true"></i></a>
          
        </div>
      
    </section>
  </div>
</footer>

      
    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-837842-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


  <script src="/js/app.js"></script>
  
  </body>
</html>
