<!doctype html><html lang=en-us><meta charset=utf-8><meta name=template-type content="snippets"><meta name=template-kind content="page"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/suponet.css integrity><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel=stylesheet><meta name=author content="Susan Potter"><title>No subtyping in PureScript [page : snippets] &ndash; Software development team lead, architect, enabler, heretic, and wearer of many hats with a functional programming and infrastructure engineering focus.</title><meta name=description content="Susan Potter is a distributed systems and infrastructure software developer/architect/leader who likes to wear many hats, write strongly typed pure functional programs, and listens to bad pop music."><meta name=keywords content="[]"><meta name=theme-color content="#EC4899"><meta name=og:site_name content="Susan Potter"><meta name=og:title content="No subtyping in PureScript &ndash; Susan Potter"><meta name=og:url content="/snippets/no-subtyping-in-purescript/"><meta name=og:description content="Susan Potter is a distributed systems and infrastructure software developer/architect/leader who likes to wear many hats, write strongly typed pure functional programs, and listens to bad pop music."><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="SusanPotter"><meta name=twitter:creator content="SusanPotter"><meta name=twitter:image content="images/hat-collage-xs.webp"><meta name=twitter:image:alt content="Susan's avatar wearing many different hats."><meta name=twitter:title content="No subtyping in PureScript &ndash; Software development team lead, architect, enabler, heretic, and wearer of many hats with a functional programming and infrastructure engineering focus."><meta name=twitter:description content><meta property="og:type" content="website"><link rel=manifest href=manifest.json><link rel=mask-icon href=favicon.svg color=#ffffff><link rel=icon href=favicon.svg><link rel=apple-touch-icon href=apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=apple-touch-icon-precompose.png><body class="text-gray-800 dark:text-gray-200 bg-gray-50 dark:bg-gray-700 mx-auto"><header class="flex flex-col text-gray-600 bg-white body-font dark:bg-gray-900 shadow-md"><div class="container mx-auto flex flex-wrap py-6 px-12 flex-col md:flex-row items-center"><a href=/ class="flex title-font font-medium items-center text-gray-700 dark:text-gray-200 mb-4 md:mb-0 hover:no-underline"><h1 class="ml-3 text-2xl font-bold hover:text-black">Susan Potter</h1></a><nav class="md:ml-auto flex flex-wrap items-center text-base justify-center gap-y-2 gap-x-4"><ul class="flex right-0 top-0 p-0 m-0"><li class="flex-1 m-0 py-2 rounded-lg
focus:dark:border-gray-300 hover:dark:border-gray-800
focus:bg-sky-50 focus:border focus:border-gray-600 focus:shadow-md
hover:bg-sky-50 hover:text-pink-900 hover:border hover:border-gray-400 hover:shadow-md"><a href=/about/ class="mx-6 py-2 px-4 text-xl text-pink-700 hover:no-underline dark:text-pink-300">About</a></li><li class="flex-1 m-0 py-2 rounded-lg
focus:dark:border-gray-300 hover:dark:border-gray-800
focus:bg-sky-50 focus:border focus:border-gray-600 focus:shadow-md
hover:bg-sky-50 hover:text-pink-900 hover:border hover:border-gray-400 hover:shadow-md"><a href=/talks/ class="mx-6 py-2 px-4 text-xl text-pink-700 hover:no-underline dark:text-pink-300">Talks</a></li><li class="flex-1 m-0 py-2 rounded-lg
focus:dark:border-gray-300 hover:dark:border-gray-800
focus:bg-sky-50 focus:border focus:border-gray-600 focus:shadow-md
hover:bg-sky-50 hover:text-pink-900 hover:border hover:border-gray-400 hover:shadow-md"><a href=/software/ class="mx-6 py-2 px-4 text-xl text-pink-700 hover:no-underline dark:text-pink-300">Software</a></li><li class="flex-1 m-0 py-2 rounded-lg
focus:dark:border-gray-300 hover:dark:border-gray-800
focus:bg-sky-50 focus:border focus:border-gray-600 focus:shadow-md
hover:bg-sky-50 hover:text-pink-900 hover:border hover:border-gray-400 hover:shadow-md"><a href=/snippets/ class="mx-6 py-2 px-4 text-xl text-pink-700 hover:no-underline dark:text-pink-300">Snippets</a></li></ul></nav></div><hgroup class="text-black dark:text-gray-50 container mx-auto px-16 pb-3"><h2 class="text-3xl font-extrabold tracking-wider leading-loose">No subtyping in PureScript</h2><h3 class="text-gray-800 dark:text-gray-200">Fri September 9, 2020</h3><h4 class="uppercase text-gray-600 dark:text-gray-200 font-bold">DRAFT</h4></hgroup></header><main class="container mt-0 mx-auto px-4 md:px-8 lg:px-16 xl:px-24 2xl:px-32 mb-2 md:mb-4 lg:mb-8 xl:mb-16 2xl:mb-24 rounded-sm border shadow-md border-gray-200 dark:border-gray-600 py-2"><p>This is an excerpt from a code review that I sanitized for public
consumption. Changes include modifying code examples to not refer to
internal types or domains:</p><hr><p>PureScript (like Haskell) has zero notion of <strong>subtyping</strong>. Subtyping is
often paired with inheritance in OO languages to derive moderate
amounts of reuse from class-based hierarchies. Today, the OO
community appears to prefer OO <em>"composition"</em> over inheritance
(<a href=https://en.wikipedia.org/wiki/Composition_over_inheritance).>https://en.wikipedia.org/wiki/Composition_over_inheritance).</a></p><p>Typically OO <em>composition</em> yields simpler and more practical solutions
to problems beyond the toy examples found in OO textbooks back in the
day. Interestingly, Alan Kay disputes that OO is about inheritance
(it's about "message passing" to him).</p><p>So, since we don't have <em>subtyping</em>, you might be wondering what the
<strong>data constructors</strong> in an algebraic data type's definition are about?</p><p>These are not subtypes. It does not inherit any behavior, a data
constructor is just one valid way of constructing values for its type.</p><p>Consider:</p><div class="src src-haskell"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell><span style=color:#66d9ef>data</span> <span style=color:#66d9ef>Shape</span>
  <span style=color:#f92672>=</span> <span style=color:#66d9ef>Square</span> { length <span style=color:#f92672>::</span> <span style=color:#66d9ef>Number</span> }
  <span style=color:#f92672>|</span> <span style=color:#66d9ef>Rectangle</span> { width <span style=color:#f92672>::</span> <span style=color:#66d9ef>Number</span>, height <span style=color:#f92672>::</span> <span style=color:#66d9ef>Number</span> }
  <span style=color:#f92672>|</span> <span style=color:#66d9ef>Circle</span> { radius <span style=color:#f92672>::</span> <span style=color:#66d9ef>Number</span> }</code></pre></div></div><p>In the above data definition we have defined a type named <code class=verbatim>Shape</code>. It
has three data constructors (<code class=verbatim>Square</code>, <code class=verbatim>Rectangle</code>, and <code class=verbatim>Circle</code>). These are
functions that have a capitalized first character for the name. If you
look at their types you will see they are basically just functions
with names that look a different than usual:</p><div class="src src-haskell"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell><span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#66d9ef>:</span>t <span style=color:#66d9ef>Square</span>
<span style=color:#66d9ef>Square</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>Number</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>Shape</span>

<span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#66d9ef>:</span>t <span style=color:#66d9ef>Rectangle</span>
<span style=color:#66d9ef>Rectangle</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>Number</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>Number</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>Shape</span>

<span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#66d9ef>:</span>t <span style=color:#66d9ef>Circle</span>
<span style=color:#66d9ef>Circle</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>Number</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>Shape</span></code></pre></div></div><p>At the type-level it doesn't have subtypes of <code class=verbatim>Square</code>, <code class=verbatim>Rectangle</code>, or
<code class=verbatim>Circle</code>. They are just data constructors which are simply functions with
beginning with a capital letter. They define a way to construct valid
values of the type <code class=verbatim>Shape</code>. That's it.</p><p>Now, back to the original crux of your question: <em>how would we be able
to share structural definitions across types?</em></p><hr><p>Ok, next installment. How can we share the structure of a type definition?</p><p>In OO languages we would use subtyping to get interface compatibility. The reason this felt so necessary in OO is that this paradigm couples data definition and object behavior together fairly tightly (you put methods in your class definition which contains your data structure and exposes getters/setters/modifiers as well as side-effecting behavior).</p><p>In functional programming (FP) we define the data definition and then functions that consume or produce this data more independently although they can both be packaged together in the same module for coherence when that is useful (for data hiding/encapsulation, etc.).</p><p>So what we want in FP isn't subtyping but rather the ability to share the structure of a data definition across type definitions.</p><p>Let's introduce the following data types and functions:</p><div class="src src-haskell"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell><span style=color:#66d9ef>data</span> <span style=color:#66d9ef>Employee</span>
  <span style=color:#f92672>=</span> <span style=color:#66d9ef>MkEmployee</span> { firstName <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span>, lastName <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span>, title <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span>, address <span style=color:#f92672>::</span> <span style=color:#66d9ef>Address</span> }

<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>Customer</span>
  <span style=color:#f92672>=</span> <span style=color:#66d9ef>BusinessEntity</span> { legalName <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span>, address <span style=color:#f92672>::</span> <span style=color:#66d9ef>Address</span>, contacts <span style=color:#f92672>::</span> <span style=color:#66d9ef>Array</span> <span style=color:#66d9ef>Contact</span> }
  <span style=color:#f92672>|</span> <span style=color:#66d9ef>Individual</span> { firstName <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span>, lastName <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span>, address <span style=color:#f92672>::</span> <span style=color:#66d9ef>Address</span> }

<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>Contact</span>
  <span style=color:#f92672>=</span> <span style=color:#66d9ef>MkContact</span> { firstName <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span>, lastName <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span>, title<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span>, address <span style=color:#f92672>::</span> <span style=color:#66d9ef>Address</span> }

<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>Address</span>
  <span style=color:#f92672>=</span> <span style=color:#66d9ef>MkAddress</span> { streetAddress1 <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span>, streetAddress2 <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span>, city <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span>, state <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span>, zipcode <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span> }

<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>Suffix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>Jr</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>Sr</span>
<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>Prefix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>Dr</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>Professor</span>

<span style=color:#a6e22e>addSuffix</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>Suffix</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>Employee</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>Employee</span>
<span style=color:#a6e22e>addSuffix</span> <span style=color:#66d9ef>Jr</span> emp <span style=color:#f92672>=</span> emp { lastName <span style=color:#f92672>=</span> emp<span style=color:#f92672>.</span>lastName <span style=color:#f92672>&lt;&gt;</span> <span style=color:#e6db74>&#34;, Jr.&#34;</span> }
<span style=color:#a6e22e>addSuffix</span> <span style=color:#66d9ef>Sr</span> emp <span style=color:#f92672>=</span> emp { lastName <span style=color:#f92672>=</span> emp<span style=color:#f92672>.</span>lastName <span style=color:#f92672>&lt;&gt;</span> <span style=color:#e6db74>&#34;, Sr.&#34;</span> }

<span style=color:#a6e22e>addPrefix</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>Prefix</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>Employee</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>Employee</span>
<span style=color:#a6e22e>addPrefix</span> <span style=color:#66d9ef>Dr</span> emp <span style=color:#f92672>=</span> emp { firstName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Dr. &#34;</span> <span style=color:#f92672>&lt;&gt;</span> emp<span style=color:#f92672>.</span>firstName }
<span style=color:#a6e22e>addPrefix</span> <span style=color:#66d9ef>Professor</span> emp <span style=color:#f92672>=</span> emp { firstName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Prof. &#34;</span> <span style=color:#f92672>&lt;&gt;</span> emp<span style=color:#f92672>.</span>firstName }

<span style=color:#75715e>-- Exercise for the reader! :)</span>
<span style=color:#a6e22e>addSuffix</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>Suffix</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>Contact</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>Contact</span>
<span style=color:#a6e22e>addPrefix</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>Prefix</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>Contact</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>Contact</span></code></pre></div></div><p>Ok, so the issue here is that we might want to support <code class=verbatim>addSuffix</code> and <code class=verbatim>addPrefix</code> for all data type definitions that have a <code class=verbatim>lastName :: String</code> and <code class=verbatim>firstName :: String</code> fields respectively, but being different types we end up defining two variants even though essentially they are the same.</p><p>We can solve this in multiple ways in PureScript. We could define an "interface" via a typeclass and instances for each data type, but then we have duplication of the implementations for these "methods". Another type facility we have is structural typing which has two variations: polymorphic row types and polymorphic variants.</p><p>What we would want is the first variation, row polymorphism, for this case:</p><div class="src src-haskell"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell><span style=color:#a6e22e>addPrefix&#39;</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>Prefix</span> <span style=color:#f92672>-&gt;</span> { firstName <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span> } <span style=color:#f92672>-&gt;</span> { firstName <span style=color:#f92672>::</span> <span style=color:#66d9ef>String</span> }
<span style=color:#a6e22e>addPrefix&#39;</span> <span style=color:#66d9ef>Dr</span> prefixable <span style=color:#f92672>=</span> prefixable { firstName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Dr. &#34;</span> <span style=color:#f92672>&lt;&gt;</span> prefixable<span style=color:#f92672>.</span>firstName }
<span style=color:#a6e22e>addPrefix&#39;</span> <span style=color:#66d9ef>Professor</span> prefixable <span style=color:#f92672>=</span> prefixable { firstName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Prof. &#34;</span> <span style=color:#f92672>&lt;&gt;</span> prefixable<span style=color:#f92672>.</span>firstName }</code></pre></div></div></main><footer class="flex flex-col bottom-0 left-0 text-gray-600 dark:text-gray-200 body-font w-full mt-8 md:mt-12 lg:mt-16 xl:mt-20"><div class="bg-blue-50 dark:bg-gray-800 text-gray-600 dark:text-gray-200 p-2"><div class="container mx-auto py-4 px-16 flex flex-wrap flex-col sm:flex-row"><p class="text-sm text-center sm:text-left">© 2006 - 2021 Susan Potter —
<a href=https://twitter.com/SusanPotter rel="noopener noreferrer" class=ml-1 aria-hidden=true>@SusanPotter</a></p><span class="inline-flex sm:ml-auto sm:mt-0 mt-2 justify-center sm:justify-start"><a href=https://github.com/mbbx6spp/ class=ml-3 title="mbbx6spp on Github" aria-label="Susan is mbbx6spp on Github"><img src=/images/github.svg width=24 height=24 alt="Github icon"></a>
<a href=https://keybase.io/mbbx6spp class=ml-3 title="mbbx6spp on Keybase" aria-label="Susan is mbbx6spp on Keybase"><img src=/images/keybase.svg width=24 height=24 alt="Keybase icon"></a>
<a href=https://www.linkedin.com/in/susanpotter/ class=ml-3 title="susanpotter on LinkedIn" aria-label="Susan is susanpotter on LinkedIn"><img src=/images/linkedin.svg width=24 height=24 alt="LinkedIn icon"></a>
<a href=https://slideshare.net/mbbx6spp class=ml-3 title="mbbx6spp on Slideshare" aria-label="Susan is mbbx6spp on Slideshare"><img src=/images/slideshare.svg width=24 height=24 alt="Slideshare icon"></a>
<a href=https://twitter.com/SusanPotter class=ml-3 title="SusanPotter on Twitter" aria-label="Susan is SusanPotter on Twitter"><img src=/images/twitter.svg width=24 height=24 alt="Twitter icon"></a></span></div></div></footer></body></html>