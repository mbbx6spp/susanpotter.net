<!DOCTYPE html>
<html lang="en-us">

  <head>
    <meta charset="utf-8">
    <meta name="theme-color" content="#123652"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Susan Potter">
    <meta name="description" content="/">
    <meta name="keywords" content="Distributed Systems, Functional Programming, Systems Architecture, Software Development, Software Engineering Leadership, Technical Strategy">

    <meta property="og:site_name" content="Susan Potter">
    <meta property="og:title" content="
  No subtyping in PureScript - Susan Potter
">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/snippets/no-subtyping-in-purescript/">
    <meta property="og:image" content="/">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="/snippets/no-subtyping-in-purescript/">
    <meta name="twitter:image" content="/">

    <title>
  No subtyping in PureScript - Susan Potter
</title>

    <link rel="canonical" href="/snippets/no-subtyping-in-purescript/">
    
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
    
    <link  rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700">
    <link rel="stylesheet" href="/css/normalize.min.css">
    <link rel="stylesheet" href="/css/style.min.css">

    

    
      <link rel="stylesheet" href="/styles/main.css">
    

    <link href="/favicon.ico" rel="shortcut icon">

    
      <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Susan Potter">
      <link href="/index.xml" rel="feed" type="application/rss+xml" title="Susan Potter" />
    

    <meta name="generator" content="Hugo 0.64.0" />
  </head>

  <body class="">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">Susan Potter</a>
    <input type="checkbox" id="menu-control"/>
    <label class="menu-mobile  float-right " for="menu-control">
      <span class="btn-mobile  float-right ">&#9776;</span>
      <ul class="navigation-list">
        
          
            <li class="navigation-item   align-left  ">
              <a class="navigation-link" href="/about/">About</a>
            </li>
          
            <li class="navigation-item   align-left  ">
              <a class="navigation-link" href="/talks/">Talks</a>
            </li>
          
            <li class="navigation-item   align-left  ">
              <a class="navigation-link" href="/software/">Software</a>
            </li>
          
            <li class="navigation-item   align-left  ">
              <a class="navigation-link" href="/snippets/">Snippets</a>
            </li>
          
        
        
      </ul>
    </label>
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>No subtyping in PureScript</h1>
      <div class="dateinfo">
        
        <span class="date"><strong>Date:</strong> September 11, 2020</span>
        
        
        <span class="lastmod"><strong>Last modified:</strong> September 11, 2020</span>
        
      
        <div class="draft">DRAFT</div>
      

      </div>

    </header>

    <p>
This is an excerpt from a code review that I sanitized for public
consumption. Changes include modifying code examples to not refer to
internal types or domains:
</p>
<hr>
<p>
PureScript (like Haskell) has zero notion of <strong>subtyping</strong>. Subtyping is
often paired with inheritance in OO languages to derive moderate
amounts of reuse from class-based hierarchies. Today, the OO
community appears to prefer OO <em>&#34;composition&#34;</em> over inheritance
(<a href="https://en.wikipedia.org/wiki/Composition_over_inheritance).">https://en.wikipedia.org/wiki/Composition_over_inheritance).</a>
</p>
<p>
Typically OO <em>composition</em> yields simpler and more practical solutions
to problems beyond the toy examples found in OO textbooks back in the
day. Interestingly, Alan Kay disputes that OO is about inheritance
(it&#39;s about &#34;message passing&#34; to him).
</p>
<p>
So, since we don&#39;t have <em>subtyping</em>, you might be wondering what the
<strong>data constructors</strong> in an algebraic data type&#39;s definition are about?
</p>
<p>
These are not subtypes. It does not inherit any behavior, a data
constructor is just one valid way of constructing values for its type.
</p>
<p>
Consider:
</p>
<div class="src src-haskell">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-haskell" data-lang="haskell"><span style="color:#66d9ef">data</span> <span style="color:#66d9ef">Shape</span>
  <span style="color:#f92672">=</span> <span style="color:#66d9ef">Square</span> { length <span style="color:#f92672">::</span> <span style="color:#66d9ef">Number</span> }
  <span style="color:#f92672">|</span> <span style="color:#66d9ef">Rectangle</span> { width <span style="color:#f92672">::</span> <span style="color:#66d9ef">Number</span>, height <span style="color:#f92672">::</span> <span style="color:#66d9ef">Number</span> }
  <span style="color:#f92672">|</span> <span style="color:#66d9ef">Circle</span> { radius <span style="color:#f92672">::</span> <span style="color:#66d9ef">Number</span> }</code></pre></div>
</div>
<p>
In the above data definition we have defined a type named <code class="verbatim">Shape</code>. It
has three data constructors (<code class="verbatim">Square</code>, <code class="verbatim">Rectangle</code>, and <code class="verbatim">Circle</code>). These are
functions that have a capitalized first character for the name. If you
look at their types you will see they are basically just functions
with names that look a different than usual:
</p>
<div class="src src-haskell">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-haskell" data-lang="haskell"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">:</span>t <span style="color:#66d9ef">Square</span>
<span style="color:#66d9ef">Square</span> <span style="color:#f92672">::</span> <span style="color:#66d9ef">Number</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Shape</span>

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">:</span>t <span style="color:#66d9ef">Rectangle</span>
<span style="color:#66d9ef">Rectangle</span> <span style="color:#f92672">::</span> <span style="color:#66d9ef">Number</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Number</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Shape</span>

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">:</span>t <span style="color:#66d9ef">Circle</span>
<span style="color:#66d9ef">Circle</span> <span style="color:#f92672">::</span> <span style="color:#66d9ef">Number</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Shape</span></code></pre></div>
</div>
<p>
At the type-level it doesn&#39;t have subtypes of <code class="verbatim">Square</code>, <code class="verbatim">Rectangle</code>, or
<code class="verbatim">Circle</code>. They are just data constructors which are simply functions with
beginning with a capital letter. They define a way to construct valid
values of the type <code class="verbatim">Shape</code>. That&#39;s it.
</p>
<p>
Now, back to the original crux of your question: <em>how would we be able
to share structural definitions across types?</em>
</p>
<hr>
<p>
Ok, next installment. How can we share the structure of a type definition?
</p>
<p>
In OO languages we would use subtyping to get interface compatibility. The reason this felt so necessary in OO is that this paradigm couples data definition and object behavior together fairly tightly (you put methods in your class definition which contains your data structure and exposes getters/setters/modifiers as well as side-effecting behavior).
</p>
<p>
In functional programming (FP) we define the data definition and then functions that consume or produce this data more independently although they can both be packaged together in the same module for coherence when that is useful (for data hiding/encapsulation, etc.).
</p>
<p>
So what we want in FP isn&#39;t subtyping but rather the ability to share the structure of a data definition across type definitions.
</p>
<p>
Let&#39;s introduce the following data types and functions:
</p>
<div class="src src-haskell">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-haskell" data-lang="haskell"><span style="color:#66d9ef">data</span> <span style="color:#66d9ef">Employee</span>
  <span style="color:#f92672">=</span> <span style="color:#66d9ef">MkEmployee</span> { firstName <span style="color:#f92672">::</span> <span style="color:#66d9ef">String</span>, lastName <span style="color:#f92672">::</span> <span style="color:#66d9ef">String</span>, title <span style="color:#f92672">::</span> <span style="color:#66d9ef">String</span>, address <span style="color:#f92672">::</span> <span style="color:#66d9ef">Address</span> }

<span style="color:#66d9ef">data</span> <span style="color:#66d9ef">Customer</span>
  <span style="color:#f92672">=</span> <span style="color:#66d9ef">BusinessEntity</span> { legalName <span style="color:#f92672">::</span> <span style="color:#66d9ef">String</span>, address <span style="color:#f92672">::</span> <span style="color:#66d9ef">Address</span>, contacts <span style="color:#f92672">::</span> <span style="color:#66d9ef">Array</span> <span style="color:#66d9ef">Contact</span> }
  <span style="color:#f92672">|</span> <span style="color:#66d9ef">Individual</span> { firstName <span style="color:#f92672">::</span> <span style="color:#66d9ef">String</span>, lastName <span style="color:#f92672">::</span> <span style="color:#66d9ef">String</span>, address <span style="color:#f92672">::</span> <span style="color:#66d9ef">Address</span> }

<span style="color:#66d9ef">data</span> <span style="color:#66d9ef">Contact</span>
  <span style="color:#f92672">=</span> <span style="color:#66d9ef">MkContact</span> { firstName <span style="color:#f92672">::</span> <span style="color:#66d9ef">String</span>, lastName <span style="color:#f92672">::</span> <span style="color:#66d9ef">String</span>, title<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span>, address <span style="color:#f92672">::</span> <span style="color:#66d9ef">Address</span> }

<span style="color:#66d9ef">data</span> <span style="color:#66d9ef">Address</span>
  <span style="color:#f92672">=</span> <span style="color:#66d9ef">MkAddress</span> { streetAddress1 <span style="color:#f92672">::</span> <span style="color:#66d9ef">String</span>, streetAddress2 <span style="color:#f92672">::</span> <span style="color:#66d9ef">String</span>, city <span style="color:#f92672">::</span> <span style="color:#66d9ef">String</span>, state <span style="color:#f92672">::</span> <span style="color:#66d9ef">String</span>, zipcode <span style="color:#f92672">::</span> <span style="color:#66d9ef">String</span> }

<span style="color:#66d9ef">data</span> <span style="color:#66d9ef">Suffix</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">Jr</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Sr</span>
<span style="color:#66d9ef">data</span> <span style="color:#66d9ef">Prefix</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">Dr</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Professor</span>

<span style="color:#a6e22e">addSuffix</span> <span style="color:#f92672">::</span> <span style="color:#66d9ef">Suffix</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Employee</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Employee</span>
<span style="color:#a6e22e">addSuffix</span> <span style="color:#66d9ef">Jr</span> emp <span style="color:#f92672">=</span> emp { lastName <span style="color:#f92672">=</span> emp<span style="color:#f92672">.</span>lastName <span style="color:#f92672">&lt;&gt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">, Jr.</span><span style="color:#e6db74">&#34;</span> }
<span style="color:#a6e22e">addSuffix</span> <span style="color:#66d9ef">Sr</span> emp <span style="color:#f92672">=</span> emp { lastName <span style="color:#f92672">=</span> emp<span style="color:#f92672">.</span>lastName <span style="color:#f92672">&lt;&gt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">, Sr.</span><span style="color:#e6db74">&#34;</span> }

<span style="color:#a6e22e">addPrefix</span> <span style="color:#f92672">::</span> <span style="color:#66d9ef">Prefix</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Employee</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Employee</span>
<span style="color:#a6e22e">addPrefix</span> <span style="color:#66d9ef">Dr</span> emp <span style="color:#f92672">=</span> emp { firstName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Dr. </span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&lt;&gt;</span> emp<span style="color:#f92672">.</span>firstName }
<span style="color:#a6e22e">addPrefix</span> <span style="color:#66d9ef">Professor</span> emp <span style="color:#f92672">=</span> emp { firstName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Prof. </span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">&lt;&gt;</span> emp<span style="color:#f92672">.</span>firstName }

<span style="color:#75715e">-- Exercise for the reader! :)</span>
<span style="color:#a6e22e">addSuffix</span> <span style="color:#f92672">::</span> <span style="color:#66d9ef">Suffix</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Contact</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Contact</span>
<span style="color:#a6e22e">addPrefix</span> <span style="color:#f92672">::</span> <span style="color:#66d9ef">Prefix</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Contact</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Contact</span></code></pre></div>
</div>
<p>
Ok, so the issue here is that we might want to support <code class="verbatim">addSuffix</code> and <code class="verbatim">addPrefix</code> for all data type definitions that have a <code class="verbatim">lastName :: String</code> and <code class="verbatim">firstName :: String</code> fields respectively, but being different types we end up defining two variants even though essentially they are the same.
</p>
<p>
We can solve this in multiple ways in PureScript. We could define an &#34;interface&#34; via a typeclass and instances for each data type, but then we have duplication of the implementations for these &#34;methods&#34;. Another type facility we have is structural typing which has two variations: polymorphic row types and polymorphic variants.
</p>
<p>
What we would want is the first variation, row polymorphism, for this case:
</p>
<div class="src src-haskell">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-haskell" data-lang="haskell"><span style="color:#a6e22e">addPrefix&#39;</span> <span style="color:#f92672">::</span> <span style="color:#66d9ef">Prefix</span> <span style="color:#f92672">-&gt;</span> { firstName <span style="color:#f92672">::</span> <span style="color:#66d9ef">String</span> } <span style="color:#f92672">-&gt;</span> { firstName <span style="color:#f92672">::</span> <span style="color:#66d9ef">String</span> }
<span style="color:#a6e22e">addPrefix&#39;</span> <span style="color:#66d9ef">Dr</span> prefixable <span style="color:#f92672">=</span> prefixable { firstName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Dr. + &lt;&gt; prefixable.firstName }
</span><span style="color:#e6db74">addPrefix&#39; Professor prefixable = prefixable { firstName = </span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">Prof</span><span style="color:#f92672">.</span> <span style="color:#f92672">+</span> <span style="color:#f92672">&lt;&gt;</span> prefixable<span style="color:#f92672">.</span>firstName }</code></pre></div>
</div>

  </article>

  
</section>


      </div>
      
        <footer class="footer">
  <section class="container">
    
      <div class="sns-shares sp-sns-shares">
        
          <a class="sns-share twitter-share" aria-label="Share on twitter" href="https://twitter.com/intent/tweet?original_referer=%2fsnippets%2fno-subtyping-in-purescript%2f&ref_src=twsrc%5Etfw&text=No%20subtyping%20in%20PureScript Susan%20Potter&tw_p=tweetbutton&url=%2fsnippets%2fno-subtyping-in-purescript%2f"><i class="fab fa-twitter"></i></a>
        
        
          <a class="sns-share linkedIn-share" aria-label="Share on LinkedIn" href="https://www.linkedin.com/sharing/share-offsite/?url=%2fsnippets%2fno-subtyping-in-purescript%2f"><i class="fab fa-linkedin"></i></a>
        
      </div>
    
    
  </section>
  <div class="fixed-bar">
    <section class="container">
      
      <div class="social-list">
        <span>Profiles:</span>
        
          <span class="social-item">
            <a href="https://github.com/mbbx6spp/" aria-label="Github" >
              
                <i class="fab fa-github" aria-hidden="true"></i>
              
            </a>
          </span>
        
          <span class="social-item">
            <a href="https://keybase.io/mbbx6spp" aria-label="Keybase" >
              
                <i class="fab fa-keybase" aria-hidden="true"></i>
              
            </a>
          </span>
        
          <span class="social-item">
            <a href="https://www.linkedin.com/in/susanpotter/" aria-label="LinkedIn" >
              
                <i class="fab fa-linkedin" aria-hidden="true"></i>
              
            </a>
          </span>
        
          <span class="social-item">
            <a href="https://slideshare.net/mbbx6spp" aria-label="Slideshare" >
              
                <i class="fab fa-slideshare" aria-hidden="true"></i>
              
            </a>
          </span>
        
          <span class="social-item">
            <a href="https://twitter.com/SusanPotter" aria-label="Twitter" >
              
                <i class="fab fa-twitter" aria-hidden="true"></i>
              
            </a>
          </span>
        
      </div>
      
      
        <div class="sns-shares pc-sns-shares">
          <span>Share:</span>
          
            <a class="sns-share twitter-share" aria-label="Share on twitter" href="https://twitter.com/intent/tweet?original_referer=%2fsnippets%2fno-subtyping-in-purescript%2f&ref_src=twsrc%5Etfw&text=No%20subtyping%20in%20PureScript Susan%20Potter&tw_p=tweetbutton&url=%2fsnippets%2fno-subtyping-in-purescript%2f"><i class="fab fa-twitter" aria-hidden="true"></i></a>
          
          
            <a class="sns-share linkedIn-share" aria-label="Share on LinkedIn" href="https://www.linkedin.com/sharing/share-offsite/?url=%2fsnippets%2fno-subtyping-in-purescript%2f"><i class="fab fa-linkedin" aria-hidden="true"></i></a>
          
        </div>
      
    </section>
  </div>
</footer>

      
    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-837842-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


  <script src="/js/app.js"></script>
  
  </body>
</html>
