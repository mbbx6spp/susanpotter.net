<!doctype html><html lang=en-us><meta charset=utf-8><meta name=template-type content="snippets"><meta name=template-kind content="page"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/suponet.css integrity><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel=stylesheet><meta name=author content="Susan Potter"><title>Socket Statistics on Linux with ss [page : snippets] &ndash; Software development team lead, architect, enabler, heretic, and wearer of many hats with a functional programming and infrastructure engineering focus.</title><meta name=description content="Learn how to troubleshoot sockets using the ss command on Linux"><meta name=keywords content="[]"><meta name=theme-color content="#EC4899"><meta name=og:site_name content="Susan Potter"><meta name=og:title content="Socket Statistics on Linux with ss &ndash; Susan Potter"><meta name=og:url content="/snippets/socket-statistics-on-linux-with-ss/"><meta name=og:description content="Learn how to troubleshoot sockets using the ss command on Linux"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="SusanPotter"><meta name=twitter:creator content="SusanPotter"><meta name=twitter:image content="images/hat-collage-xs.webp"><meta name=twitter:image:alt content="Susan's avatar wearing many different hats."><meta name=twitter:title content="Socket Statistics on Linux with ss &ndash; Software development team lead, architect, enabler, heretic, and wearer of many hats with a functional programming and infrastructure engineering focus."><meta name=twitter:description content="Learn how to troubleshoot sockets using the ss command on Linux"><meta property="og:type" content="website"><link rel=manifest href=manifest.json><link rel=mask-icon href=favicon.svg color=#ffffff><link rel=icon href=favicon.svg><link rel=apple-touch-icon href=apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=apple-touch-icon-precompose.png><body class="text-gray-800 dark:text-gray-200 bg-gray-50 dark:bg-gray-700"><header class="flex flex-col text-gray-600 dark:text-gray-300 bg-white body-font dark:bg-gray-900 shadow-md"><div class="container mx-auto flex flex-wrap py-6 px-12 flex-col md:flex-row items-center"><a href=/ class="flex title-font font-medium items-center text-gray-700 dark:text-gray-200 mb-4 md:mb-0 hover:no-underline"><h1 class="ml-8 text-2xl font-bold hover:text-black">Susan Potter</h1></a><nav class="md:ml-auto flex flex-col sm:flex-wrap items-center text-base justify-center gap-y-4 gap-x-8"><ul class="md:flex md:flex-row right-0 top-0 p-0 m-0"><li class="sm:flex-shrink md:flex-1 m-0 rounded-lg
focus:dark:border-gray-300 hover:dark:border-gray-800
focus:bg-sky-50 focus:border focus:border-gray-600 focus:shadow-md
hover:bg-sky-50 hover:text-pink-900 hover:border hover:border-gray-400 hover:shadow-md"><a href=/about/ class="py-2 px-8 text-xl text-pink-700 hover:no-underline dark:text-pink-300">About</a></li><li class="sm:flex-shrink md:flex-1 m-0 rounded-lg
focus:dark:border-gray-300 hover:dark:border-gray-800
focus:bg-sky-50 focus:border focus:border-gray-600 focus:shadow-md
hover:bg-sky-50 hover:text-pink-900 hover:border hover:border-gray-400 hover:shadow-md"><a href=/talks/ class="py-2 px-8 text-xl text-pink-700 hover:no-underline dark:text-pink-300">Talks</a></li><li class="sm:flex-shrink md:flex-1 m-0 rounded-lg
focus:dark:border-gray-300 hover:dark:border-gray-800
focus:bg-sky-50 focus:border focus:border-gray-600 focus:shadow-md
hover:bg-sky-50 hover:text-pink-900 hover:border hover:border-gray-400 hover:shadow-md"><a href=/software/ class="py-2 px-8 text-xl text-pink-700 hover:no-underline dark:text-pink-300">Software</a></li><li class="sm:flex-shrink md:flex-1 m-0 rounded-lg
focus:dark:border-gray-300 hover:dark:border-gray-800
focus:bg-sky-50 focus:border focus:border-gray-600 focus:shadow-md
hover:bg-sky-50 hover:text-pink-900 hover:border hover:border-gray-400 hover:shadow-md"><a href=/snippets/ class="py-2 px-8 text-xl text-pink-700 hover:no-underline dark:text-pink-300">Snippets</a></li><li class="sm:flex-shrink md:flex-1 m-0 rounded-lg
focus:dark:border-gray-300 hover:dark:border-gray-800
focus:bg-sky-50 focus:border focus:border-gray-600 focus:shadow-md
hover:bg-sky-50 hover:text-pink-900 hover:border hover:border-gray-400 hover:shadow-md"><a href=/reviews/ class="py-2 px-8 text-xl text-pink-700 hover:no-underline dark:text-pink-300">Reviews</a></li></ul></nav></div><hgroup class="text-black dark:text-gray-50 container mx-auto px-16 pb-3"><h2 class="text-3xl font-extrabold tracking-wider leading-loose">Socket Statistics on Linux with ss</h2><h3 class="text-gray-800 dark:text-gray-200">Wed April 4, 2019</h3></hgroup></header><main class="container mt-0 mx-auto px-4 md:px-8 lg:px-16 xl:px-24 2xl:px-32 mb-2 md:mb-4 lg:mb-8 xl:mb-16 2xl:mb-24 rounded-sm border shadow-md border-gray-200 dark:border-gray-600 py-2"><p>An excellent tool when you need to troubleshoot distributed systems is <code class=verbatim>ss</code>, which provides visibility into TCP states of your live connections. Even if you know <code class=verbatim>netstat</code> this is a command you should get acquainted with because of its more powerful interface which requires fewer pipes to find the connection information you need and it is probably already installed on your favorite distribution.</p><p>In this post, we walk through a couple of examples, and then show a real-world production problem that can be diagnosed by effective use of <code class=verbatim>ss</code>.</p><p>To list TCP [=-t=] connections with destination port 9200 [=dst :9200=] and showing numeric port [=-n=] plus resolving DNS of addresses [=-r=] we use the following:</p><div class="src src-text"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>ss -rnt dst :9200</code></pre></div></div><p>The output of the above command might look something like this:</p><div class="src src-text"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>Recv-Q Send-Q                         Local Address:Port                           Peer Address:Port
0      0                                  localhost:28655                             localhost:9200

# OR

Recv-Q Send-Q             Local Address:Port               Peer Address:Port
0      0         mysvc1-app3.dc1.exampleapp.com:44541      logs.dc1.exampleapp.com:9200
0      0         mysvc1-app3.dc1.exampleapp.com:33389      logs.dc1.exampleapp.com:9200
0      0         mysvc1-app3.dc1.exampleapp.com:45740      logs.dc1.exampleapp.com:9200
0      0         mysvc1-app3.dc1.exampleapp.com:53848      logs.dc1.exampleapp.com:9200
0      0         mysvc1-app3.dc1.exampleapp.com:33406      logs.dc1.exampleapp.com:9200
0      0         mysvc1-app3.dc1.exampleapp.com:33407      logs.dc1.exampleapp.com:9200
0      0         mysvc1-app3.dc1.exampleapp.com:33405      logs.dc1.exampleapp.com:9200</code></pre></div></div><p>Now, this isn't very remarkable. Let's try to find TCP connections in <code class=verbatim>CLOSE_WAIT</code> state going to a specific destination address and port:</p><div class="src src-text"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ ss -tarn state close-wait

Recv-Q Send-Q                              Local Address:Port                                Peer Address:Port
1      0         mysvc-app1.dc1.exampleapp.com:40701    mysvc-app1.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:29470    mysvc-app1.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:35594    mysvc-app1.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:39683    mysvc-app1.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:22715    mysvc-app1.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:23824    mysvc-app1.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:37015   mysvc-app10.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:28927    mysvc-app1.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:37298    mysvc-app1.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:42596   mysvc-app20.dc1.exampleapp.com:50010
1      0         mysvc-app1.dc1.exampleapp.com:45345    mysvc-app1.dc1.exampleapp.com:50010</code></pre></div></div><p>What about timers on sockets? Well, <code class=verbatim>ss</code> has what you want (list all [=-a=] TCP sockets [=-t=] with resoled DNS [=-r=], numeric ports [=-n=] that are in state of <code class=verbatim>TIME_WAIT</code> with timer information [=-o=]):</p><div class="src src-text"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ ss -arnto state time-wait

Recv-Q Send-Q                              Local Address:Port                                Peer Address:Port
0      0         mysvc-app1.dc1.exampleapp.com:21665                   ldap.dc1.exampleapp.com:389    timer:(timewait,22sec,0)
0      0         mysvc-app1.dc1.exampleapp.com:45311   mysvc-app13.dc1.exampleapp.com:2191   timer:(timewait,24sec,0)
0      0         mysvc-app1.dc1.exampleapp.com:21606                   ldap.dc1.exampleapp.com:389    timer:(timewait,2.730ms,0)
0      0         mysvc-app1.dc1.exampleapp.com:40319    mysvc-app2.dc1.exampleapp.com:9092   timer:(timewait,4.949ms,0)
0      0         mysvc-app1.dc1.exampleapp.com:37364   mysvc-app12.dc1.exampleapp.com:2191   timer:(timewait,28sec,0)
0      0                                       localhost:39282                                  localhost:17123  timer:(timewait,54sec,0)</code></pre></div></div><div id=outline-container-headline-1 class=outline-3><h3 id=headline-1>Look ma, no pipes!</h3><div id=outline-text-headline-1 class=outline-text-3><p>Looking for which process is listening on a port? Simple:</p><ul><li><p>using <code class=verbatim>-l</code> we limit ourselves to listening sockets</p></li><li><p>using <code class=verbatim>-t</code> we limit ourselves to TCP</p></li><li><p>using <code class=verbatim>-n</code> we make sure the port is shown as numeric not alias</p></li><li><p>using <code class=verbatim>-r</code> we resolve the hostnames</p></li><li><p>using <code class=verbatim>-p</code> we show processes using that socket</p></li></ul><p>Remember to get process information you usually need to sudo :)</p><div class="src src-text"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ sudo ss -nltp state listening src :3030
Recv-Q Send-Q                                                           Local Address:Port                                                             Peer Address:Port
0      100                                                                  127.0.0.1:3030                                                                        *:*      users:((&#34;sensu-client&#34;,46889,17))</code></pre></div></div><p>Note the users output is a 3-tuple with the process name as first entry, the PID as the second entry and <span style=text-decoration:underline>unknown</span> third entry (to me). Anyone know, it isn't explained in the man page.</p></div></div><div id=outline-container-headline-2 class=outline-3><h3 id=headline-2>Can Anybody Hear Me?</h3><div id=outline-text-headline-2 class=outline-text-3><p>Finally, let us walk through a production issue where <code class=verbatim>ss</code> helped us get to the root of the issue faster. Recently an alert was generated when one of our services in an environnt was no longer receiving Kafka messages. After taking the necessary steps to ensure that the Kafka cluster was up and functioning correctly, we went to the node that alerted. There we used <code class=verbatim>ss</code> to check for TCP connections to Kafka we saw no established TCP connections to Kafka, but we did see a connection in TCP state <code class=verbatim>'syn-sent'</code>[1]:</p><div class="src src-text"><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ sudo ss -antlp state syn-sent dst :9200
Recv-Q                        Send-Q                                               Local Address:Port                                                 Peer Address:Port
0                             1                                                        10.4.1.40:48928                                                   10.4.1.80:9200                         users:((&#34;java&#34;,pid=13657,fd=3))</code></pre></div></div><p>The output above tells us some useful information, specifically that this host is trying to talk to Kafka, but it isn't able to connect to the broker. This information allowed us to investigate a possible networking problem, and in this specific example the DNS for Kafka had changed, and the application had cached the old entry.</p><p>1: <a href=https://en.wikipedia.org/wiki/TCP_half-open#Embryonic_connection>https://en.wikipedia.org/wiki/TCP_half-open#Embryonic_connection</a></p></div></div></main><footer class="flex flex-col bottom-0 left-0 text-gray-600 dark:text-gray-200 body-font w-full mt-8 md:mt-12 lg:mt-16 xl:mt-20"><div class="bg-blue-50 dark:bg-gray-800 text-gray-600 dark:text-gray-200 p-2"><div class="container mx-auto py-4 px-16 flex flex-wrap flex-col sm:flex-row"><p class="text-sm text-center sm:text-left">© 2006 - 2021 Susan Potter —
<a href=https://twitter.com/SusanPotter rel="noopener noreferrer" class=ml-1 aria-hidden=true>@SusanPotter</a></p><span class="inline-flex sm:ml-auto sm:mt-0 mt-2 justify-center sm:justify-start"><a href=https://github.com/mbbx6spp/ class=ml-3 title="mbbx6spp on Github" aria-label="Susan is mbbx6spp on Github"><img src=/images/github.svg width=24 height=24 alt="Github icon"></a>
<a href=https://keybase.io/mbbx6spp class=ml-3 title="mbbx6spp on Keybase" aria-label="Susan is mbbx6spp on Keybase"><img src=/images/keybase.svg width=24 height=24 alt="Keybase icon"></a>
<a href=https://www.linkedin.com/in/susanpotter/ class=ml-3 title="susanpotter on LinkedIn" aria-label="Susan is susanpotter on LinkedIn"><img src=/images/linkedin.svg width=24 height=24 alt="LinkedIn icon"></a>
<a href=https://slideshare.net/mbbx6spp class=ml-3 title="mbbx6spp on Slideshare" aria-label="Susan is mbbx6spp on Slideshare"><img src=/images/slideshare.svg width=24 height=24 alt="Slideshare icon"></a>
<a href=https://twitter.com/SusanPotter class=ml-3 title="SusanPotter on Twitter" aria-label="Susan is SusanPotter on Twitter"><img src=/images/twitter.svg width=24 height=24 alt="Twitter icon"></a></span></div></div></footer></body></html>