<!DOCTYPE html>
<html lang="en-us">

  <head>
    <meta charset="utf-8">
    <meta name="theme-color" content="#123652"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Susan Potter">
    <meta name="description" content="/">
    <meta name="keywords" content="Distributed Systems, Functional Programming, Systems Architecture, Software Development, Engineering Leadership, Technical Strategy">

    <meta property="og:site_name" content="Susan Potter">
    <meta property="og:title" content="
  Test-Infected Infrastructure - Susan Potter
">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/blogs/software/1/01/test-infected-infrastructure/">
    <meta property="og:image" content="/">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="/blogs/software/1/01/test-infected-infrastructure/">
    <meta name="twitter:image" content="/">

    <base href="../../../../../blogs/software/1/01/test-infected-infrastructure/">
    <title>
  Test-Infected Infrastructure - Susan Potter
</title>

    <link rel="canonical" href="../../../../../blogs/software/1/01/test-infected-infrastructure/">
    
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
    
    <link  rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700">
    <link rel="stylesheet" href="../../../../../css/normalize.min.css">
    <link rel="stylesheet" href="../../../../../css/style.min.css">

    

    
      <link rel="stylesheet" href="../../../../../styles/main.css">
    

    <link rel="icon" type="image/png" href="../../../../../images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../../../../images/favicon-16x16.png" sizes="16x16">

    
      <link rel="alternate" href="../../../../../index.xml" type="application/rss+xml" title="Susan Potter">
      <link href="../../../../../index.xml" rel="feed" type="application/rss+xml" title="Susan Potter" />
    

    <meta name="generator" content="Hugo 0.64.0" />
  </head>

  <body class="">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="../../../../../">Susan Potter</a>
    <input type="checkbox" id="menu-control"/>
    <label class="menu-mobile  float-right " for="menu-control">
      <span class="btn-mobile  float-right ">&#9776;</span>
      <ul class="navigation-list">
        
          
            <li class="navigation-item   align-left  ">
              <a class="navigation-link" href="../../../../../about/">About</a>
            </li>
          
            <li class="navigation-item   align-left  ">
              <a class="navigation-link" href="../../../../../talks/">Talks</a>
            </li>
          
            <li class="navigation-item   align-left  ">
              <a class="navigation-link" href="../../../../../software/">Software</a>
            </li>
          
        
        
      </ul>
    </label>
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>Test-Infected Infrastructure</h1>
      <h2 class="date">January 1, 0001</h2>
    </header>

    
<h3 id="headline-1">
Getting Real
</h3>
<p>
  Rich Hickey gave a talk at Strangeloop 2011 which I had to watch online as
  I had to leave that conference early that year - so much sadness - titled
  <em>&#34;<a href="https://www.infoq.com/presentations/Simple-Made-Easy/">Simple Made Easy</a>&#34;</em>.
</p>
<p>
  Ignore his type systems trolling.
</p>
<p>
  Highlights from the talk includes methods of informal reasoning
  about code. He derisively discounts the TDD fad, but what he says
  about &#34;guard rails&#34; and the fact that bugs still leak out from type
  systems and test suites should not be regarded as dismissing using
  them at all. He&#39;s a little dramatic at points in his delivery. To me
  he is saying that you can&#39;t think about testing in this
  zealous/religious fashion or just writing tests in a mechanical
  fashion for the sake of it. It has to help you [informally] reason
  about your code.
</p>
<p>
  Now Hickey has the luxury of working in his mostly functional LISP dialect
  on the JVM, Clojure. The rest of us, especially in TechOps, are usually
  limited to what the tools we use support bindings to. These are typically
  Ruby, Python, Ruby, C, and maybe Java (the latter is an outside chance
  usually). These are all imperative languages by default, definitely not
  functional (even if you think Ruby procs are great, or Python&#39;s lambdas
  allow you to write HOFs such as combinators, or you want to wax poetic
  about Java 8&#39;s lambdas and new Streams APIs you don&#39;t get a language with a
  standard library that cares about eliminating state or writing in a
  declarative fashion at all). This adds complexity. Which I think we can all
  agree is a bad thing.
</p>
<h3 id="headline-2">
Stating The Obvious
</h3>
<p>
  By non-functional, I mean by default you have to manage shared mutable
  state. Even not considering concurrency at all (which today is a silly
  thing with scaling across multiple cores being a necessity), you can only
  make things simple by eliminating shared or mutable from the state
  equation. For example,
</p>
<div class="src src-text">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">  Shared + Mutable + State      =&gt; Complexity (bad maintainability properties)
  Local + Mutable + State         =&gt; Simple (good maintainability properties)
  Shared + Immutable + State  =&gt; Simple (good maintainability properties)</code></pre></div>
</div>
<p>
  By composing the latter two approaches at different levels of code and the
  problem domain (examples will come next part in the blog post series) we
  can make something that was once complex into something modular,
  composeable, and simple to maintain longer term. From a business
  perspective where teams evolve, and grow or shrink or mutate organically,
  this is of paramount importance.
</p>
<h3 id="headline-3">
Enter Testing That Makes a Difference
</h3>
<p>
  Now we need to write tests for our infrastructure that can be run in an
  automated fashion. From testing Puppet manifests and modules to Sensu check
  scripts to automation scripts and beyond. The benefits of rerunnable,
  automated test suites allows us to validate changes don&#39;t break the
  existing expectations already codified in our test suite(s). It doesn&#39;t
  validate changes don&#39;t break anything. It is important to understand that
  limitation. It means we need to get better about building solid test suites.
</p>
<p>
  To do this we need to refactor shared mutable state into smaller bite sized
  pieces to eliminate either the shared or mutable part at each given point.
  This enables us to avoid problematic constructs in automated testing
  frameworks like mocks or stubs. Instead verifying a pure function with
  cases is trivial. You know what you pass in as explicit inputs to a
  function/method are the only things the function body will use to derive
  the output. So supplying the same input values each time we know we should
  get the expected output value and it doesn&#39;t depend on some shared data
  elsewhere that has to be in a certain state to compute the desired result.
  This makes testing effortless. No more excuses!
</p>
<h3 id="headline-4">
Reasoning
</h3>
<p>
  Reasoning in functional languages (even FP languages that are not pure) is
  a lot simpler when you know when side effects are likely to happen such a
  opening a file or socket (or if you are in a pure FP language like Haskell
  you know from the type when EFFECTS - they are no longer side effects when
  they are marked explicitly this way - will eventually be performed after
  evaluation and sequenced correctly).
</p>
<p>
  Reasoning, even informally, in non-functional language which are imperative
  by default, they may or may not be in the object oriented paradigm,
  requires some level of testing to ensure you can validate it&#39;s behavior to
  some degree of sanity.
</p>
<p>
  In functional languages that support parametric polymorphism we can use
  parametricity to formally reason about code from the type signatures.
  Wadler proved it with real math. It&#39;s a thing. Yeah. It&#39;s so powerful my
  knees tremble at it&#39;s awesomeness and the implications that software
  development doesn&#39;t have to suck so much in terms of quality.
  &lt;a href=&#34;<a href="https://github.com/mbbx6spp/styleguides/blob/scala-ignore/fp/PARAMETRICITY1.asciidoc">https://github.com/mbbx6spp/styleguides/blob/scala-ignore/fp/PARAMETRICITY1.asciidoc</a>&#34;&gt;
  Here is a brief, informal treatment of the ideas of parametricity for those
  without an academic background&lt;/a&gt;.
</p>
<h3 id="headline-5">
Summary
</h3>
<p>
  So the point of this blog post is to say, to improve our sanity, and our
  code quality in TechOps we really need to step up and test-infect our code
  to provide us with better informal reasoning capabilities. The next part of
  this blog post series will include examples.
</p>
<p>
  Added since someone asked in the comments:
</p>
<p>
  In addition we should explore using pure functional languages, more
  efficient runtimes, and/or type safe languages in our infrastructure
  adventures to solve some of the problems that exist in the common Ops
  languages and runtimes.
</p>

  </article>
</section>


      </div>
      
        <footer class="footer">
  <section class="container">
    
      <div class="sns-shares sp-sns-shares">
        
          <a class="sns-share twitter-share" aria-label="Share on twitter" href="https://twitter.com/intent/tweet?original_referer=%2fblogs%2fsoftware%2f1%2f01%2ftest-infected-infrastructure%2f&ref_src=twsrc%5Etfw&text=Test-Infected%20Infrastructure Susan%20Potter&tw_p=tweetbutton&url=%2fblogs%2fsoftware%2f1%2f01%2ftest-infected-infrastructure%2f"><i class="fab fa-twitter"></i></a>
        
        
          <a class="sns-share linkedIn-share" aria-label="Share on LinkedIn" href="https://www.linkedin.com/sharing/share-offsite/?url=%2fblogs%2fsoftware%2f1%2f01%2ftest-infected-infrastructure%2f"><i class="fab fa-linkedin"></i></a>
        
      </div>
    
    
  </section>
  <div class="fixed-bar">
    <section class="container">
      
      <div class="social-list">
        <span>Profiles:</span>
        
          <span class="social-item">
            <a href="https://github.com/mbbx6spp/" aria-label="Github" >
              
                <i class="fab fa-github" aria-hidden="true"></i>
              
            </a>
          </span>
        
          <span class="social-item">
            <a href="https://keybase.io/mbbx6spp" aria-label="Keybase" >
              
                <i class="fab fa-keybase" aria-hidden="true"></i>
              
            </a>
          </span>
        
          <span class="social-item">
            <a href="https://www.linkedin.com/in/susanpotter/" aria-label="LinkedIn" >
              
                <i class="fab fa-linkedin" aria-hidden="true"></i>
              
            </a>
          </span>
        
          <span class="social-item">
            <a href="https://slideshare.net/mbbx6spp" aria-label="Slideshare" >
              
                <i class="fab fa-slideshare" aria-hidden="true"></i>
              
            </a>
          </span>
        
          <span class="social-item">
            <a href="https://twitter.com/SusanPotter" aria-label="Twitter" >
              
                <i class="fab fa-twitter" aria-hidden="true"></i>
              
            </a>
          </span>
        
      </div>
      
      
        <div class="sns-shares pc-sns-shares">
          <span>Share:</span>
          
            <a class="sns-share twitter-share" aria-label="Share on twitter" href="https://twitter.com/intent/tweet?original_referer=%2fblogs%2fsoftware%2f1%2f01%2ftest-infected-infrastructure%2f&ref_src=twsrc%5Etfw&text=Test-Infected%20Infrastructure Susan%20Potter&tw_p=tweetbutton&url=%2fblogs%2fsoftware%2f1%2f01%2ftest-infected-infrastructure%2f"><i class="fab fa-twitter" aria-hidden="true"></i></a>
          
          
            <a class="sns-share linkedIn-share" aria-label="Share on LinkedIn" href="https://www.linkedin.com/sharing/share-offsite/?url=%2fblogs%2fsoftware%2f1%2f01%2ftest-infected-infrastructure%2f"><i class="fab fa-linkedin" aria-hidden="true"></i></a>
          
        </div>
      
    </section>
  </div>
</footer>

      
    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-837842-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


  <script src="../../../../../js/app.js"></script>
  
  </body>
</html>
